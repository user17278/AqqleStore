{"version":3,"sources":["uni-app:///main.js","webpack:///D:/Hbulider/Aqqle/pages/location/location.vue?3baf","webpack:///D:/Hbulider/Aqqle/pages/location/location.vue?6539","webpack:///D:/Hbulider/Aqqle/pages/location/location.vue?740c","webpack:///D:/Hbulider/Aqqle/pages/location/location.vue?26ae","uni-app:///pages/location/location.vue","webpack:///D:/Hbulider/Aqqle/pages/location/location.vue?99a7"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","renderjs","component","options","__file","components","render","_vm","this","_h","$createElement","_self","_c","recyclableRender","staticRenderFns","_withStripped"],"mappings":"oIAAA,KAGA,YACA,W,mDAFAA,GAAGC,kCAAoCC,EAGvCC,EAAWC,a,+DCLX,sHACIC,EADJ,QASIC,EAAY,qBACd,aACA,YACA,sBACA,EACA,KACA,WACA,MACA,EACA,gBACAD,GAGFC,EAAUC,QAAQC,OAAS,8BACZ,aAAAF,E,yCCvBf,sQ,gCCAA,IAAIG,EAAJ,0LACA,IAAIC,EAAS,WACX,IAAIC,EAAMC,KACNC,EAAKF,EAAIG,eACJH,EAAII,MAAMC,IAEjBC,GAAmB,EACnBC,EAAkB,GACtBR,EAAOS,eAAgB,G,gCCRvB,6GAAguB,eAAG,G,6mBC4EnuB,CACA,KADA,WAEA,OACA,6CACA,uBACA,wBACA,mBACA,oBACA,eACA,gBACA,YACA,iBACA,oBACA,iBACA,cACA,iBACA,oBACA,aACA,sBACA,gBACA,aACA,eACA,oBAGA,OAzBA,WAyBA,WAEA,4CACA,EACA,gCACA,eACA,iBACA,oBACA,sCAIA,OAEA,sCACA,yCAEA,0BACA,oBACA,+CACA,mBAIA,0BAEA,WACA,SACA,4BAEA,kBACA,oCACA,sCACA,kCAGA,2BAEA,OA/DA,WAgEA,6BAEA,4EAGA,mEAEA,iCACA,4BACA,8BAIA,QA7EA,WA8EA,iDAEA,SAhFA,WAiFA,8BAEA,UACA,UADA,WACA,IACA,uCACA,uCAGA,OACA,WACA,QADA,SACA,KACA,KACA,uBAEA,0BAKA,SACA,8BADA,SACA,GACA,qBAGA,mBALA,WAKA,WACA,wCAEA,gBAEA,oBACA,yBAIA,0BAfA,SAeA,gBACA,sBACA,uBAEA,sBACA,uBACA,kCACA,aACA,4IACA,WADA,gBAEA,oBACA,yBACA,mBAJA,uBAMA,IANA,YAMA,iBANA,qBAOA,gCAPA,yEAUA,6DAVA,eAUA,EAVA,iBAWA,0BAXA,QAMA,IANA,uBAaA,mBAbA,wGAmBA,YA1CA,SA0CA,kBACA,kCACA,8BACA,gBACA,MACA,2BACA,8BAEA,IACA,CACA,WACA,cAGA,oBACA,yDAMA,iBA/DA,SA+DA,OACA,OACA,KACA,sBACA,gCACA,iCACA,0BACA,WACA,0BACA,cACA,eACA,SACA,wBACA,cACA,iBACA,qBACA,gBACA,wBAGA,4BAGA,YAtFA,WAuFA,4BACA,sEACA,mDACA,sDAIA,aA9FA,SA8FA,GACA,kCAEA,iCACA,yDACA,yDAGA,4CACA,qBACA,uDACA,oCACA,uCAEA,gDACA,oCACA,uCAMA,SApHA,WAqHA,cACA,sDAIA,WA1HA,WA2HA,gCAGA,mBA9HA,WA8HA,WACA,kDACA,eACA,aACA,oBACA,6BACA,mCAKA,oBAzIA,SAyIA,GACA,gCACA,4CACA,4CAGA,+BACA,KAIA,QACA,sBACA,6EAGA,eAzJA,SAyJA,GACA,qBACA,8BACA,2BACA,uBAIA,YAjKA,SAiKA,GACA,8BACA,0CAGA,YAtKA,WAuKA,kBACA,sBACA,4EAGA,SA5KA,SA4KA,KACA,cACA,iHAIA,YACA,mB,0ECnWA,6GAA23C,eAAG,G","file":"pages/location/location.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/location/location.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./location.vue?vue&type=template&id=1dc6e226&scoped=true&\"\nvar renderjs\nimport script from \"./location.vue?vue&type=script&lang=js&\"\nexport * from \"./location.vue?vue&type=script&lang=js&\"\nimport style0 from \"./location.vue?vue&type=style&index=0&id=1dc6e226&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!C:\\\\Users\\\\MASS\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"1dc6e226\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/location/location.vue\"\nexport default component.exports","export * from \"-!C:\\\\Users\\\\MASS\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!C:\\\\Users\\\\MASS\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--16-0!C:\\\\Users\\\\MASS\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!C:\\\\Users\\\\MASS\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!C:\\\\Users\\\\MASS\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!C:\\\\Users\\\\MASS\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./location.vue?vue&type=template&id=1dc6e226&scoped=true&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!C:\\\\Users\\\\MASS\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!C:\\\\Users\\\\MASS\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!C:\\\\Users\\\\MASS\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!C:\\\\Users\\\\MASS\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!C:\\\\Users\\\\MASS\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./location.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!C:\\\\Users\\\\MASS\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!C:\\\\Users\\\\MASS\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!C:\\\\Users\\\\MASS\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!C:\\\\Users\\\\MASS\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!C:\\\\Users\\\\MASS\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./location.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view style=\"height: 100vh; overflow-y: hidden;\">\r\n\t\t<view class=\"sticky\">\r\n\t\t\t<view class=\"status_bar\"></view>\r\n\t\t\t<view class=\"wx-nav\">\r\n\t\t\t\t<view class=\"flex-item\"></view>\r\n\t\t\t\t<text class=\"wx-nav-title flex-item\">你身边的门店</text>\r\n\t\t\t\t<view class=\"flex-item\"></view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<view class=\"location\">\r\n\t\t\t<view class=\"location-search bg-color\" :style=\"{ position: isMapShow ? 'absolute' : 'static' }\">\r\n\t\t\t\t<view class=\"current-location\" @tap=\"toSearch\">\r\n\t\t\t\t\t<view class=\"iconfont\" style=\"margin-right: 4rpx;font-size: 22rpx; font-weight: 900\" v-show=\"currentCity.length\">&#xe624;</view>\r\n\t\t\t\t\t{{ currentCity }}\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"search-box\">\r\n\t\t\t\t\t<view class=\"iconfont\" style=\"margin-top:4rpx; color: #8f8e93;font-size: 26rpx;\">&#xe62d;</view>\r\n\t\t\t\t\t<input\r\n\t\t\t\t\t\tclass=\"search-box-input\"\r\n\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\t:value=\"searchKey\"\r\n\t\t\t\t\t\tplaceholder=\"搜索门店\"\r\n\t\t\t\t\t\tplaceholder-style=\"color:#8f8e93\"\r\n\t\t\t\t\t\t@input=\"getInputlength\"\r\n\t\t\t\t\t\t@confirm=\"finishInput\"\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<view class=\"iconfont\" style=\"margin-top:4rpx; margin-right: 10rpx; color: #999999;font-size: 26rpx;\" v-show=\"isShowDelete\" @tap=\"deleteInput\">&#xe6a6;</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"mode-tab\" @tap=\"changeMode\">{{ isMapShow ? '切换列表模式' : '切换地图模式' }}</view>\r\n\t\t\t</view>\r\n\t\t\t<!-- 地图模式 -->\r\n\t\t\t<view class=\"location-show\" v-if=\"isMapShow\">\r\n\t\t\t\t<view class=\"loading-tip\" v-show=\"isShowLoading\">{{ loadingTip }}</view>\r\n\t\t\t\t<swiper class=\"swiper-box\" previous-margin=\"50rpx\" next-margin=\"50rpx\" @change=\"changeSwiper\" v-if=\"!isShowLoading\">\r\n\t\t\t\t\t<swiper-item v-for=\"(item, index) in nearlyShopArr\" :key=\"index\" @tap=\"toDetail(item, index)\">\r\n\t\t\t\t\t\t<view class=\"swiper-item\" :style=\"{ border: swiperIndex === index ? 'solid 1px #007aff' : 'none' }\">\r\n\t\t\t\t\t\t\t<image class=\"swiper-img\" :src=\"nearlyShopImgArr\" mode=\"aspectFill\"></image>\r\n\t\t\t\t\t\t\t<view class=\"detail\">\r\n\t\t\t\t\t\t\t\t<view class=\"name\">{{ item.title }}</view>\r\n\t\t\t\t\t\t\t\t<view class=\"address\">{{ item.address }}</view>\r\n\t\t\t\t\t\t\t\t<view class=\"distance\">\r\n\t\t\t\t\t\t\t\t\t<view class=\"iconfont\" style=\"font-size: 22rpx; margin-right: 10rpx;\">&#xe63e;</view>\r\n\t\t\t\t\t\t\t\t\t{{ item.distance }} km\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</swiper-item>\r\n\t\t\t\t</swiper>\r\n\t\t\t</view>\r\n\t\t\t<map\r\n\t\t\t\tid=\"map\"\r\n\t\t\t\tclass=\"map\"\r\n\t\t\t\tname=\"map\"\r\n\t\t\t\t:style=\"{ height: mapHeight + 'px' }\"\r\n\t\t\t\t:subkey=\"subkey\"\r\n\t\t\t\tlayer-style=\"1\"\r\n\t\t\t\t:latitude=\"currentLatitude\"\r\n\t\t\t\t:longitude=\"currentLongitude\"\r\n\t\t\t\t:show-location=\"true\"\r\n\t\t\t\t:scale=\"10\"\r\n\t\t\t\t:markers=\"nearlyShopArr\"\r\n\t\t\t\t@markertap=\"changeMarker\"\r\n\t\t\t\t@updated=\"firstMarker\"\r\n\t\t\t\tv-show=\"isMapShow\"\r\n\t\t\t></map>\r\n\t\t\t<!-- 列表模式 -->\r\n\t\t\t<scroll-view class=\"list-mode-scroll-view\" scroll-y=\"true\" v-if=\"!isMapShow\" :style=\"{ height: mapHeight + 'px' }\">\r\n\t\t\t\t<NearlyShopList :nearlyShopArr=\"nearlyShopArr\" :nearlyShopImgArr=\"nearlyShopImgArr\" @getNearlyShopListClientHeight=\"getNearlyShopListClientHeight\"></NearlyShopList>\r\n\t\t\t</scroll-view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\nimport NearlyShopList from '../../components/location/NearlyShopList.vue';\r\nexport default {\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tsubkey: 'M7ABZ-22FH4-7URUL-XDEVT-MSXO2-3FBLZ',\r\n\t\t\tcurrentLatitude: Number,\r\n\t\t\tcurrentLongitude: Number,\r\n\t\t\tnewLatitude: Number,\r\n\t\t\tnewLongitude: Number,\r\n\t\t\tcurrentCity: '', //当前城市\r\n\t\t\tamapPlugin: null, //高德地图相关\r\n\t\t\tqqmapsdk: {},\r\n\t\t\tnearlyShopArr: [], //最近的授权点\r\n\t\t\tstickyHeight: Number, //顶栏高度\r\n\t\t\tmapHeight: Number, //地图高度\r\n\t\t\tswiperIndex: 0, //当前滑动栏序号\r\n\t\t\tisShowLoading: true, //是否显示加载提示\r\n\t\t\tnearlyShopImgArr: [], //最近的授权点照片\r\n\t\t\tisMapShow: true, //地图列表模式切换\r\n\t\t\tloadingTip: '门店查找中...',\r\n\t\t\tisShowDelete: false, //输入框删除按钮\r\n\t\t\tsearchKey: '', //输入的关键词\r\n\t\t\tclientHeight: 0, //附近授权店列表高度\r\n\t\t\tisChangeLatLng: false //检测城市是否更新\r\n\t\t};\r\n\t},\r\n\tonLoad() {\r\n\t\t// 计算导航栏状态栏高度，地图高度动态适配\r\n\t\tlet viewSticky = uni.createSelectorQuery().select('.sticky');\r\n\t\tviewSticky\r\n\t\t\t.boundingClientRect(data => {\r\n\t\t\t\tlet stickyHeight = data.height;\r\n\t\t\t\tuni.getSystemInfo({\r\n\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\tthis.mapHeight = res.windowHeight - stickyHeight + 20;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t\t.exec();\r\n\t\t// 高德地图相关\r\n\t\tthis.amapPlugin = new this.amap.AMapWX({\r\n\t\t\tkey: '90fb262cfdec4c92e6efd487be75c9b9'\r\n\t\t});\r\n\t\tthis.amapPlugin.getRegeo({\r\n\t\t\tsuccess: res => {\r\n\t\t\t\tlet cityName = res[0].regeocodeData.addressComponent.city;\r\n\t\t\t\tthis.currentCity = cityName;\r\n\t\t\t}\r\n\t\t});\r\n\t\t// 获取当前定位\r\n\t\tthis.getCurrentLocaiton();\r\n\t\t// 获取标记点图标，门店图片\r\n\t\tthis.$http\r\n\t\t\t.request({\r\n\t\t\t\turl: '/location-list/data'\r\n\t\t\t})\r\n\t\t\t.then(res => {\r\n\t\t\t\tthis.nearlyShopImgArr = res.data[2].imgUrl;\r\n\t\t\t\tthis.currentLocationImg = res.data[0].imgUrl;\r\n\t\t\t\tthis.locationImg = res.data[1].imgUrl;\r\n\t\t\t});\r\n\t\t// 监听城市更新\r\n\t\tthis.cityLocationUpdate();\r\n\t},\r\n\tonShow() {\r\n\t\tif (this.nearlyShopArr.length == 0) {\r\n\t\t\t// 获取当前定位点周边授权店\r\n\t\t\tthis.getAppleShopInCurrentCity(this.currentLatitude, this.currentLongitude);\r\n\t\t} else {\r\n\t\t\t// 获取更新后城市授权点\r\n\t\t\tthis.getAppleShopInCurrentCity(this.newLatitude, this.newLongitude);\r\n\t\t\t// 标记点聚焦跟随\r\n\t\t\tthis._mapContext.moveToLocation({\r\n\t\t\t\tlongitude: this.newLongitude,\r\n\t\t\t\tlatitude: this.newLatitude\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\tonReady() {\r\n\t\tthis._mapContext = uni.createMapContext('map', this);\r\n\t},\r\n\tonUnload() {\r\n\t\tuni.$off('cityLocationUpdate');\r\n\t},\r\n\tcomputed: {\r\n\t\tnewLatLng() {\r\n\t\t\tconst { newLatitude, newLongitude } = this;\r\n\t\t\treturn { newLatitude, newLongitude };\r\n\t\t}\r\n\t},\r\n\twatch: {\r\n\t\tnewLatLng: {\r\n\t\t\thandler(newVal, oldVal) {\r\n\t\t\t\tif (newVal != oldVal) {\r\n\t\t\t\t\tthis.isChangeLatLng = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.isChnageLatLng = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\tgetNearlyShopListClientHeight(height) {\r\n\t\t\tthis.clientHeight = height;\r\n\t\t},\r\n\t\t// 如果城市被自定义选择，重新获取城市定位,重新聚焦\r\n\t\tcityLocationUpdate() {\r\n\t\t\tuni.$on('cityLocationUpdate', data => {\r\n\t\t\t\t// 每次更新城市重置底部滑动栏序号\r\n\t\t\t\tthis.swiperIndex = 0;\r\n\t\t\t\t// 先获取新城市经纬度\r\n\t\t\t\tthis.newLatitude = data.lat;\r\n\t\t\t\tthis.newLongitude = data.lng;\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 获取城市周边苹果授权店\r\n\t\tgetAppleShopInCurrentCity(lat, lng) {\r\n\t\t\tif (this.isChangeLatLng) {\r\n\t\t\t\tthis.nearlyShopArr = [];\r\n\t\t\t}\r\n\t\t\tthis.qqmapsdk.search({\r\n\t\t\t\tkeyword: 'Apple授权专营店-店',\r\n\t\t\t\tlocation: { latitude: lat, longitude: lng },\r\n\t\t\t\tpage_size: 20,\r\n\t\t\t\tsuccess: async res => {\r\n\t\t\t\t\tif (res.count == 0) {\r\n\t\t\t\t\t\tthis.loadingTip = '暂无门店';\r\n\t\t\t\t\t\tthis.nearlyShopArr = [{ id: 0 }];\r\n\t\t\t\t\t\tthis.isShowLoading = true;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tfor (let i = 0; i < res.data.length; i++) {\r\n\t\t\t\t\t\t\tif (res.data[i].title.indexOf('-') == -1) {\r\n\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tconst distance = await this.getDistance(res.data[i].location.lat, res.data[i].location.lng);\r\n\t\t\t\t\t\t\tawait this.addNearlyShopArr(res, i, distance);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.isShowLoading = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 获取当前定位点到门店距离\r\n\t\tgetDistance(lat, lng, title) {\r\n\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\tthis.qqmapsdk.calculateDistance({\r\n\t\t\t\t\tmode: 'straight',\r\n\t\t\t\t\tfrom: {\r\n\t\t\t\t\t\tlatitude: this.currentLatitude,\r\n\t\t\t\t\t\tlongitude: this.currentLongitude\r\n\t\t\t\t\t},\r\n\t\t\t\t\tto: [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tlatitude: lat,\r\n\t\t\t\t\t\t\tlongitude: lng\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t],\r\n\t\t\t\t\tsuccess: data => {\r\n\t\t\t\t\t\tresolve((data.result.elements[0].distance / 1000).toFixed(2));\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 添加授权店标记点\r\n\t\taddNearlyShopArr(res, i, distance) {\r\n\t\t\tvar marker = {\r\n\t\t\t\tid: i,\r\n\t\t\t\ttitle: res.data[i].title,\r\n\t\t\t\tlatitude: res.data[i].location.lat,\r\n\t\t\t\tlongitude: res.data[i].location.lng,\r\n\t\t\t\taddress: res.data[i].address,\r\n\t\t\t\tdistance: distance,\r\n\t\t\t\ticonPath: this.locationImg,\r\n\t\t\t\twidth: '40rpx',\r\n\t\t\t\theight: '40rpx',\r\n\t\t\t\tcallout: {\r\n\t\t\t\t\tcontent: res.data[i].title,\r\n\t\t\t\t\tcolor: 'white',\r\n\t\t\t\t\tfontSize: '26rpx',\r\n\t\t\t\t\tborderRadius: '12rpx',\r\n\t\t\t\t\tbgColor: 'black',\r\n\t\t\t\t\tpadding: '10rpx 10rpx'\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tthis.nearlyShopArr.push(marker);\r\n\t\t},\r\n\t\t// 对第一个标记点显示黑色加大\r\n\t\tfirstMarker() {\r\n\t\t\tif (this.nearlyShopArr.length) {\r\n\t\t\t\tthis.nearlyShopArr[this.swiperIndex].iconPath = this.currentLocationImg;\r\n\t\t\t\tthis.nearlyShopArr[this.swiperIndex].width = '60rpx';\r\n\t\t\t\tthis.nearlyShopArr[this.swiperIndex].height = '60rpx';\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 滑动底部门店信息卡片，标记点聚焦跟随\r\n\t\tchangeSwiper(e) {\r\n\t\t\tthis.swiperIndex = e.detail.current;\r\n\t\t\t// 标记点聚焦跟随\r\n\t\t\tthis._mapContext.moveToLocation({\r\n\t\t\t\tlongitude: this.nearlyShopArr[this.swiperIndex].longitude,\r\n\t\t\t\tlatitude: this.nearlyShopArr[this.swiperIndex].latitude\r\n\t\t\t});\r\n\t\t\t// 聚焦标记点黑色\r\n\t\t\tfor (let i = 0; i < this.nearlyShopArr.length; i++) {\r\n\t\t\t\tif (i == this.swiperIndex) {\r\n\t\t\t\t\tthis.nearlyShopArr[i].iconPath = this.currentLocationImg;\r\n\t\t\t\t\tthis.nearlyShopArr[i].width = '60rpx';\r\n\t\t\t\t\tthis.nearlyShopArr[i].height = '60rpx';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.nearlyShopArr[i].iconPath = this.locationImg;\r\n\t\t\t\t\tthis.nearlyShopArr[i].width = '40rpx';\r\n\t\t\t\t\tthis.nearlyShopArr[i].height = '40rpx';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t// 点击进入Search页面搜索城市\r\n\t\ttoSearch() {\r\n\t\t\tuni.navigateTo({\r\n\t\t\t\turl: '/pages/search/search?name=CityList&text=搜索城市'\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 改变显示模式 地图模式→列表模式\r\n\t\tchangeMode() {\r\n\t\t\tthis.isMapShow = !this.isMapShow;\r\n\t\t},\r\n\t\t// 获取当前定位\r\n\t\tgetCurrentLocaiton() {\r\n\t\t\tthis.qqmapsdk = new this.QQMapWX({ key: this.subkey });\r\n\t\t\tuni.getLocation({\r\n\t\t\t\ttype: 'gcj02',\r\n\t\t\t\tsuccess: res => {\r\n\t\t\t\t\tthis.currentLatitude = res.latitude;\r\n\t\t\t\t\tthis.currentLongitude = res.longitude;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 搜索结果处理\r\n\t\tsearchResultHandler(searchKey) {\r\n\t\t\tconsole.log(this.nearlyShopArr);\r\n\t\t\tfor (let i = 0; i < this.nearlyShopArr.length; i++) {\r\n\t\t\t\tif (this.nearlyShopArr[i].title.indexOf(searchKey) >= 0) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.nearlyShopArr.splice(i, 1);\r\n\t\t\t\t\ti--;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// 输入为空时重新获取\r\n\t\t\tif (searchKey == '') {\r\n\t\t\t\tthis.nearlyShopArr = [];\r\n\t\t\t\tthis.getAppleShopInCurrentCity(this.currentLatitude, this.currentLongitude);\r\n\t\t\t}\r\n\t\t},\r\n\t\tgetInputlength(e) {\r\n\t\t\tthis.isShowDelete = true;\r\n\t\t\tthis.searchKey = e.detail.value;\r\n\t\t\tif (e.detail.value.length == 0) {\r\n\t\t\t\tthis.isShowDelete = false;\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 完成输入\r\n\t\tfinishInput(e) {\r\n\t\t\tthis.searchKey = e.detail.value;\r\n\t\t\tthis.searchResultHandler(this.searchKey);\r\n\t\t},\r\n\t\t// 删除结果\r\n\t\tdeleteInput() {\r\n\t\t\tthis.searchKey = '';\r\n\t\t\tthis.nearlyShopArr = [];\r\n\t\t\tthis.getAppleShopInCurrentCity(this.currentLatitude, this.currentLongitude);\r\n\t\t},\r\n\t\t// 点击swiper-item去往详细页\r\n\t\ttoDetail(item, index) {\r\n\t\t\tuni.navigateTo({\r\n\t\t\t\turl: '/pages/nearlyShop/nearlyShop?item=' + encodeURIComponent(JSON.stringify(item)) + '&img=' + this.nearlyShopImgArr\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\tcomponents: {\r\n\t\tNearlyShopList\r\n\t}\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.wx-nav {\r\n\tdisplay: flex;\r\n\tjustify-content: flex-start;\r\n\t.wx-nav-title {\r\n\t\tmargin-left: 10rpx;\r\n\t}\r\n\t.flex-item {\r\n\t\tflex: none;\r\n\t}\r\n}\r\n.location {\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n\tposition: relative;\r\n\t.location-search {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tposition: absolute;\r\n\t\twidth: 750rpx;\r\n\t\theight: 140rpx;\r\n\t\tz-index: 1;\r\n\t\t.current-location {\r\n\t\t\tdisplay: flex;\r\n\t\t\tjustify-content: center;\r\n\t\t\talign-items: center;\r\n\t\t\tflex: 1;\r\n\t\t\tcolor: #007aff;\r\n\t\t\tfont-size: 26rpx;\r\n\t\t}\r\n\t\t.search-box {\r\n\t\t\tflex: 2.5;\r\n\t\t\tdisplay: flex;\r\n\t\t\talign-items: center;\r\n\t\t\tpadding: 6rpx 16rpx;\r\n\t\t\tborder-radius: 20rpx;\r\n\t\t\tbackground-color: #ffffff;\r\n\t\t\t.search-box-input {\r\n\t\t\t\tflex: 1;\r\n\t\t\t\tmargin: 0 26rpx 0 10rpx;\r\n\t\t\t\tfont-size: 22rpx;\r\n\t\t\t\tcolor: #333333;\r\n\t\t\t}\r\n\t\t}\r\n\t\t.mode-tab {\r\n\t\t\tflex: 1.5;\r\n\t\t\tcolor: #007aff;\r\n\t\t\tfont-size: 26rpx;\r\n\t\t\ttext-align: center;\r\n\t\t}\r\n\t}\r\n\t.map {\r\n\t\twidth: 750rpx;\r\n\t}\r\n\r\n\t.location-show {\r\n\t\tposition: absolute;\r\n\t\tbottom: 0rpx;\r\n\t\twidth: 100vw;\r\n\t\tz-index: 1;\r\n\t\t.loading-tip {\r\n\t\t\tposition: fixed;\r\n\t\t\tbottom: 200rpx;\r\n\t\t\tleft: 50%;\r\n\t\t\tpadding: 6rpx 60rpx;\r\n\t\t\ttransform: translateX(-50%);\r\n\t\t\tbackground-color: #000000;\r\n\t\t\tborder-radius: 10rpx;\r\n\t\t\tfont-size: 24rpx;\r\n\t\t\tcolor: #ffffff;\r\n\t\t}\r\n\r\n\t\t.swiper-box {\r\n\t\t\theight: 300rpx;\r\n\t\t}\r\n\t}\r\n}\r\n.list-mode-scroll-view {\r\n\tpadding: 0 20rpx;\r\n\tbox-sizing: border-box;\r\n}\r\n.swiper-item {\r\n\tdisplay: flex;\r\n\tpadding: 20rpx;\r\n\tmargin: 0 10rpx 20rpx 10rpx;\r\n\tborder-radius: 30rpx;\r\n\tbackground-color: #ffffff;\r\n\t.swiper-img {\r\n\t\twidth: 150rpx;\r\n\t\theight: 150rpx;\r\n\t\tborder-radius: 30rpx;\r\n\t}\r\n\t.detail {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\tjustify-content: space-between;\r\n\t\tmargin: 12rpx 30rpx;\r\n\t\twidth: 380rpx;\r\n\t\t.name {\r\n\t\t\tfont-size: 26rpx;\r\n\t\t\toverflow: hidden;\r\n\t\t\twhite-space: nowrap;\r\n\t\t\ttext-overflow: ellipsis;\r\n\t\t}\r\n\t\t.address {\r\n\t\t\tmargin-bottom: 30rpx;\r\n\t\t\tcolor: #929292;\r\n\t\t\tfont-size: 24rpx;\r\n\t\t\toverflow: hidden;\r\n\t\t\twhite-space: nowrap;\r\n\t\t\ttext-overflow: ellipsis;\r\n\t\t}\r\n\t\t.distance {\r\n\t\t\tdisplay: flex;\r\n\t\t\talign-items: center;\r\n\t\t\tfont-size: 22rpx;\r\n\t\t}\r\n\t}\r\n}\r\n</style>\n","import mod from \"-!C:\\\\Users\\\\MASS\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!C:\\\\Users\\\\MASS\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!C:\\\\Users\\\\MASS\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!C:\\\\Users\\\\MASS\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!C:\\\\Users\\\\MASS\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!C:\\\\Users\\\\MASS\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!C:\\\\Users\\\\MASS\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!C:\\\\Users\\\\MASS\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!C:\\\\Users\\\\MASS\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./location.vue?vue&type=style&index=0&id=1dc6e226&lang=scss&scoped=true&\"; export default mod; export * from \"-!C:\\\\Users\\\\MASS\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!C:\\\\Users\\\\MASS\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!C:\\\\Users\\\\MASS\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!C:\\\\Users\\\\MASS\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!C:\\\\Users\\\\MASS\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!C:\\\\Users\\\\MASS\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!C:\\\\Users\\\\MASS\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!C:\\\\Users\\\\MASS\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!C:\\\\Users\\\\MASS\\\\Desktop\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./location.vue?vue&type=style&index=0&id=1dc6e226&lang=scss&scoped=true&\""],"sourceRoot":""}