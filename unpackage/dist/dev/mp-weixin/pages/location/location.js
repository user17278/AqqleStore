(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/location/location"],{31:function(t,e,n){"use strict";(function(t){n(5);i(n(4));var e=i(n(32));function i(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=n,t(e.default)}).call(this,n(1)["createPage"])},32:function(t,e,n){"use strict";n.r(e);var i=n(33),r=n(35);for(var a in r)"default"!==a&&function(t){n.d(e,t,(function(){return r[t]}))}(a);n(40);var o,u=n(11),s=Object(u["default"])(r["default"],i["render"],i["staticRenderFns"],!1,null,"1dc6e226",null,!1,i["components"],o);s.options.__file="pages/location/location.vue",e["default"]=s.exports},33:function(t,e,n){"use strict";n.r(e);var i=n(34);n.d(e,"render",(function(){return i["render"]})),n.d(e,"staticRenderFns",(function(){return i["staticRenderFns"]})),n.d(e,"recyclableRender",(function(){return i["recyclableRender"]})),n.d(e,"components",(function(){return i["components"]}))},34:function(t,e,n){"use strict";var i;n.r(e),n.d(e,"render",(function(){return r})),n.d(e,"staticRenderFns",(function(){return o})),n.d(e,"recyclableRender",(function(){return a})),n.d(e,"components",(function(){return i}));var r=function(){var t=this,e=t.$createElement;t._self._c},a=!1,o=[];r._withStripped=!0},35:function(t,e,n){"use strict";n.r(e);var i=n(36),r=n.n(i);for(var a in i)"default"!==a&&function(t){n.d(e,t,(function(){return i[t]}))}(a);e["default"]=r.a},36:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=r(n(37));function r(t){return t&&t.__esModule?t:{default:t}}function a(t,e,n,i,r,a,o){try{var u=t[a](o),s=u.value}catch(c){return void n(c)}u.done?e(s):Promise.resolve(s).then(i,r)}function o(t){return function(){var e=this,n=arguments;return new Promise((function(i,r){var o=t.apply(e,n);function u(t){a(o,i,r,u,s,"next",t)}function s(t){a(o,i,r,u,s,"throw",t)}u(void 0)}))}}var u=function(){n.e("components/location/NearlyShopList").then(function(){return resolve(n(137))}.bind(null,n)).catch(n.oe)},s={data:function(){return{subkey:"M7ABZ-22FH4-7URUL-XDEVT-MSXO2-3FBLZ",currentLatitude:Number,currentLongitude:Number,newLatitude:Number,newLongitude:Number,currentCity:"",amapPlugin:null,qqmapsdk:{},nearlyShopArr:[],stickyHeight:Number,mapHeight:Number,swiperIndex:0,isShowLoading:!0,nearlyShopImgArr:[],isMapShow:!0,loadingTip:"门店查找中...",isShowDelete:!1,searchKey:"",clientHeight:0,isChangeLatLng:!1}},onLoad:function(){var e=this,n=t.createSelectorQuery().select(".sticky");n.boundingClientRect((function(n){var i=n.height;t.getSystemInfo({success:function(t){e.mapHeight=t.windowHeight-i+20}})})).exec(),this.amapPlugin=new this.amap.AMapWX({key:"90fb262cfdec4c92e6efd487be75c9b9"}),this.amapPlugin.getRegeo({success:function(t){var n=t[0].regeocodeData.addressComponent.city;e.currentCity=n}}),this.getCurrentLocaiton(),this.$http.request({url:"/location-list/data"}).then((function(t){e.nearlyShopImgArr=t.data[2].imgUrl,e.currentLocationImg=t.data[0].imgUrl,e.locationImg=t.data[1].imgUrl})),this.cityLocationUpdate()},onShow:function(){0==this.nearlyShopArr.length?this.getAppleShopInCurrentCity(this.currentLatitude,this.currentLongitude):(this.getAppleShopInCurrentCity(this.newLatitude,this.newLongitude),this._mapContext.moveToLocation({longitude:this.newLongitude,latitude:this.newLatitude}))},onReady:function(){this._mapContext=t.createMapContext("map",this)},onUnload:function(){t.$off("cityLocationUpdate")},computed:{newLatLng:function(){var t=this.newLatitude,e=this.newLongitude;return{newLatitude:t,newLongitude:e}}},watch:{newLatLng:{handler:function(t,e){t!=e?this.isChangeLatLng=!0:this.isChnageLatLng=!1}}},methods:{getNearlyShopListClientHeight:function(t){this.clientHeight=t},cityLocationUpdate:function(){var e=this;t.$on("cityLocationUpdate",(function(t){e.swiperIndex=0,e.newLatitude=t.lat,e.newLongitude=t.lng}))},getAppleShopInCurrentCity:function(t,e){var n=this;this.isChangeLatLng&&(this.nearlyShopArr=[]),this.qqmapsdk.search({keyword:"Apple授权专营店-店",location:{latitude:t,longitude:e},page_size:20,success:function(){var t=o(i.default.mark((function t(e){var r,a;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(0!=e.count){t.next=6;break}n.loadingTip="暂无门店",n.nearlyShopArr=[{id:0}],n.isShowLoading=!0,t.next=19;break;case 6:r=0;case 7:if(!(r<e.data.length)){t.next=18;break}if(-1!=e.data[r].title.indexOf("-")){t.next=10;break}return t.abrupt("continue",15);case 10:return t.next=12,n.getDistance(e.data[r].location.lat,e.data[r].location.lng);case 12:return a=t.sent,t.next=15,n.addNearlyShopArr(e,r,a);case 15:r++,t.next=7;break;case 18:n.isShowLoading=!1;case 19:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}()})},getDistance:function(t,e,n){var i=this;return new Promise((function(n,r){i.qqmapsdk.calculateDistance({mode:"straight",from:{latitude:i.currentLatitude,longitude:i.currentLongitude},to:[{latitude:t,longitude:e}],success:function(t){n((t.result.elements[0].distance/1e3).toFixed(2))}})}))},addNearlyShopArr:function(t,e,n){var i={id:e,title:t.data[e].title,latitude:t.data[e].location.lat,longitude:t.data[e].location.lng,address:t.data[e].address,distance:n,iconPath:this.locationImg,width:"40rpx",height:"40rpx",callout:{content:t.data[e].title,color:"white",fontSize:"26rpx",borderRadius:"12rpx",bgColor:"black",padding:"10rpx 10rpx"}};this.nearlyShopArr.push(i)},firstMarker:function(){this.nearlyShopArr.length&&(this.nearlyShopArr[this.swiperIndex].iconPath=this.currentLocationImg,this.nearlyShopArr[this.swiperIndex].width="60rpx",this.nearlyShopArr[this.swiperIndex].height="60rpx")},changeSwiper:function(t){this.swiperIndex=t.detail.current,this._mapContext.moveToLocation({longitude:this.nearlyShopArr[this.swiperIndex].longitude,latitude:this.nearlyShopArr[this.swiperIndex].latitude});for(var e=0;e<this.nearlyShopArr.length;e++)e==this.swiperIndex?(this.nearlyShopArr[e].iconPath=this.currentLocationImg,this.nearlyShopArr[e].width="60rpx",this.nearlyShopArr[e].height="60rpx"):(this.nearlyShopArr[e].iconPath=this.locationImg,this.nearlyShopArr[e].width="40rpx",this.nearlyShopArr[e].height="40rpx")},toSearch:function(){t.navigateTo({url:"/pages/search/search?name=CityList&text=搜索城市"})},changeMode:function(){this.isMapShow=!this.isMapShow},getCurrentLocaiton:function(){var e=this;this.qqmapsdk=new this.QQMapWX({key:this.subkey}),t.getLocation({type:"gcj02",success:function(t){e.currentLatitude=t.latitude,e.currentLongitude=t.longitude}})},searchResultHandler:function(t){console.log(this.nearlyShopArr);for(var e=0;e<this.nearlyShopArr.length;e++)this.nearlyShopArr[e].title.indexOf(t)>=0||(this.nearlyShopArr.splice(e,1),e--);""==t&&(this.nearlyShopArr=[],this.getAppleShopInCurrentCity(this.currentLatitude,this.currentLongitude))},getInputlength:function(t){this.isShowDelete=!0,this.searchKey=t.detail.value,0==t.detail.value.length&&(this.isShowDelete=!1)},finishInput:function(t){this.searchKey=t.detail.value,this.searchResultHandler(this.searchKey)},deleteInput:function(){this.searchKey="",this.nearlyShopArr=[],this.getAppleShopInCurrentCity(this.currentLatitude,this.currentLongitude)},toDetail:function(e,n){t.navigateTo({url:"/pages/nearlyShop/nearlyShop?item="+encodeURIComponent(JSON.stringify(e))+"&img="+this.nearlyShopImgArr})}},components:{NearlyShopList:u}};e.default=s}).call(this,n(1)["default"])},40:function(t,e,n){"use strict";n.r(e);var i=n(41),r=n.n(i);for(var a in i)"default"!==a&&function(t){n.d(e,t,(function(){return i[t]}))}(a);e["default"]=r.a},41:function(t,e,n){}},[[31,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/location/location.js.map